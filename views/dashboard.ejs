<%- include('layout', { body: `
<h2 class="mb-4"><i class="bi bi-speedometer2"></i> Dashboard</h2>

<!-- Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon bg-primary"><i class="bi bi-receipt"></i></div>
            <div class="stat-info">
                <h3>${stats.total_transactions.toLocaleString()}</h3>
                <p>Total Transactions</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon bg-success"><i class="bi bi-currency-rupee"></i></div>
            <div class="stat-info">
                <h3>₹${Math.round(stats.total_spent).toLocaleString()}</h3>
                <p>Total Spent</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon bg-warning"><i class="bi bi-calendar-month"></i></div>
            <div class="stat-info">
                <h3>₹${Math.round(stats.month_spent).toLocaleString()}</h3>
                <p>This Month</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon bg-info"><i class="bi bi-graph-up"></i></div>
            <div class="stat-info">
                <h3>₹${Math.round(stats.avg_transaction).toLocaleString()}</h3>
                <p>Avg Transaction</p>
            </div>
        </div>
    </div>
</div>

<!-- Budget Progress -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-piggy-bank"></i> Monthly Budget</h5>
    </div>
    <div class="card-body">
        <div class="d-flex justify-content-between mb-2">
            <span>₹${Math.round(stats.month_spent).toLocaleString()} spent</span>
            <span>₹${budget.toLocaleString()} budget</span>
        </div>
        <div class="progress" style="height: 25px;">
            <div class="progress-bar ${(stats.month_spent / budget) > 0.9 ? 'bg-danger' : (stats.month_spent / budget) > 0.7 ? 'bg-warning' : 'bg-success'}" 
                 style="width: ${Math.min(100, (stats.month_spent / budget) * 100)}%">
                ${Math.round((stats.month_spent / budget) * 100)}%
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Prediction Card -->
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-magic"></i> Next Month Prediction</h5>
            </div>
            <div class="card-body">
                ${predictions.prediction > 0 ? `
                    <div class="text-center py-3">
                        <h2 class="text-primary mb-2">₹${predictions.prediction.toLocaleString()}</h2>
                        <p class="text-muted mb-3">Predicted spending</p>
                        <span class="badge bg-${predictions.trend === 'increasing' ? 'danger' : predictions.trend === 'decreasing' ? 'success' : 'secondary'} fs-6">
                            <i class="bi bi-arrow-${predictions.trend === 'increasing' ? 'up' : predictions.trend === 'decreasing' ? 'down' : 'right'}"></i>
                            ${predictions.trend.charAt(0).toUpperCase() + predictions.trend.slice(1)} trend
                        </span>
                        <div class="mt-3">
                            <small class="text-muted">Confidence: ${predictions.confidence}%</small>
                        </div>
                    </div>
                ` : `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-info-circle fs-1"></i>
                        <p class="mt-2">Add more transactions to enable predictions</p>
                    </div>
                `}
            </div>
        </div>
    </div>

    <!-- Category Breakdown -->
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-pie-chart"></i> Top Categories</h5>
            </div>
            <div class="card-body">
                ${stats.categoryBreakdown.length > 0 ? `
                    <canvas id="categoryChart" height="200"></canvas>
                ` : `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-pie-chart fs-1"></i>
                        <p class="mt-2">No spending data yet</p>
                    </div>
                `}
            </div>
        </div>
    </div>
</div>

<!-- Monthly Trend Chart -->
${stats.monthlyTrend.length > 0 ? `
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-graph-up"></i> Monthly Spending Trend</h5>
    </div>
    <div class="card-body">
        <canvas id="trendChart" height="100"></canvas>
    </div>
</div>
` : ''}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Category Chart
    const categoryData = ${JSON.stringify(stats.categoryBreakdown.slice(0, 6))};
    if (categoryData.length > 0 && document.getElementById('categoryChart')) {
        new Chart(document.getElementById('categoryChart'), {
            type: 'doughnut',
            data: {
                labels: categoryData.map(c => c.category),
                datasets: [{
                    data: categoryData.map(c => c.total),
                    backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1', '#20c997']
                }]
            },
            options: { plugins: { legend: { position: 'right' } } }
        });
    }

    // Trend Chart
    const trendData = ${JSON.stringify(stats.monthlyTrend)};
    if (trendData.length > 0 && document.getElementById('trendChart')) {
        new Chart(document.getElementById('trendChart'), {
            type: 'line',
            data: {
                labels: trendData.map(t => t.month),
                datasets: [{
                    label: 'Spending',
                    data: trendData.map(t => t.total),
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                scales: { y: { beginAtZero: true } },
                plugins: { legend: { display: false } }
            }
        });
    }
});
</script>
`, title: 'Dashboard', active: 'dashboard' }) %>
